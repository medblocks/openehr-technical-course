<div class="vital-signs-form">
        <mb-auto-form id="mbform"></mb-auto-form>
        <button onclick="handleSubmit(event)" type="submit">Submit</button>
    </form>
</div>
<link href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.71/dist/themes/light.min.css" rel="stylesheet"/>
<script src="https://unpkg.com/medblocks-ui@0.0.207/dist/bundle.js"></script>
<script>
    const form = document.getElementById('mbform')
    form.webTemplate = {
  "templateId" : "vital_signs.v1",
  "semVer" : "0.2.0",
  "version" : "2.3",
  "defaultLanguage" : "en",
  "languages" : [ "en" ],
  "tree" : {
    "id" : "vital_signs.v0",
    "name" : "vital_signs.v0",
    "localizedName" : "vital_signs.v0",
    "rmType" : "COMPOSITION",
    "nodeId" : "openEHR-EHR-COMPOSITION.encounter.v1",
    "min" : 1,
    "max" : 1,
    "localizedNames" : {
      "en" : "vital_signs.v0"
    },
    "localizedDescriptions" : {
      "en" : "Interaction, contact or care event between a subject of care and healthcare provider(s)."
    },
    "aqlPath" : "",
    "children" : [ {
      "id" : "context",
      "rmType" : "EVENT_CONTEXT",
      "nodeId" : "",
      "min" : 1,
      "max" : 1,
      "aqlPath" : "/context",
      "children" : [ {
        "id" : "start_time",
        "name" : "Start_time",
        "rmType" : "DV_DATE_TIME",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/context/start_time",
        "inputs" : [ {
          "type" : "DATETIME"
        } ],
        "inContext" : true
      }, {
        "id" : "setting",
        "name" : "Setting",
        "rmType" : "DV_CODED_TEXT",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/context/setting",
        "inputs" : [ {
          "suffix" : "code",
          "type" : "TEXT"
        }, {
          "suffix" : "value",
          "type" : "TEXT"
        } ],
        "inContext" : true
      } ]
    }, {
      "id" : "pulse_heart_beat",
      "name" : "Pulse/Heart beat",
      "localizedName" : "Pulse/Heart beat",
      "rmType" : "OBSERVATION",
      "nodeId" : "openEHR-EHR-OBSERVATION.pulse.v2",
      "min" : 0,
      "max" : 1,
      "localizedNames" : {
        "en" : "Pulse/Heart beat"
      },
      "localizedDescriptions" : {
        "en" : "The rate and associated attributes for a pulse or heart beat."
      },
      "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]",
      "children" : [ {
        "id" : "any_event",
        "name" : "Any event",
        "localizedName" : "Any event",
        "rmType" : "EVENT",
        "nodeId" : "at0003",
        "min" : 0,
        "max" : -1,
        "localizedNames" : {
          "en" : "Any event"
        },
        "localizedDescriptions" : {
          "en" : "Default, unspecified point in time or interval event which may be explicitly defined in a template or at run-time."
        },
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/data[at0002]/events[at0003]",
        "children" : [ {
          "id" : "rate",
          "name" : "Rate",
          "localizedName" : "Rate",
          "rmType" : "DV_QUANTITY",
          "nodeId" : "at0004",
          "min" : 0,
          "max" : 1,
          "localizedNames" : {
            "en" : "Rate"
          },
          "localizedDescriptions" : {
            "en" : "The rate of the pulse or heart beat, measured in beats per minute."
          },
          "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value",
          "inputs" : [ {
            "suffix" : "magnitude",
            "type" : "DECIMAL",
            "validation" : {
              "range" : {
                "minOp" : ">=",
                "min" : 0.0,
                "maxOp" : "<",
                "max" : 1000.0
              },
              "precision" : {
                "minOp" : ">=",
                "min" : 0,
                "maxOp" : "<=",
                "max" : 0
              }
            }
          }, {
            "suffix" : "unit",
            "type" : "CODED_TEXT",
            "list" : [ {
              "value" : "/min",
              "label" : "/min",
              "validation" : {
                "range" : {
                  "minOp" : ">=",
                  "min" : 0.0,
                  "maxOp" : "<",
                  "max" : 1000.0
                },
                "precision" : {
                  "minOp" : ">=",
                  "min" : 0,
                  "maxOp" : "<=",
                  "max" : 0
                }
              }
            } ]
          } ]
        }, {
          "id" : "time",
          "name" : "Time",
          "rmType" : "DV_DATE_TIME",
          "min" : 1,
          "max" : 1,
          "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/data[at0002]/events[at0003]/time",
          "inputs" : [ {
            "type" : "DATETIME"
          } ],
          "inContext" : true
        } ]
      }, {
        "id" : "language",
        "name" : "Language",
        "rmType" : "CODE_PHRASE",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/language",
        "inContext" : true
      }, {
        "id" : "encoding",
        "name" : "Encoding",
        "rmType" : "CODE_PHRASE",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/encoding",
        "inContext" : true
      }, {
        "id" : "subject",
        "name" : "Subject",
        "rmType" : "PARTY_PROXY",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.pulse.v2]/subject",
        "inputs" : [ {
          "suffix" : "id",
          "type" : "TEXT"
        }, {
          "suffix" : "id_scheme",
          "type" : "TEXT"
        }, {
          "suffix" : "id_namespace",
          "type" : "TEXT"
        }, {
          "suffix" : "name",
          "type" : "TEXT"
        } ],
        "inContext" : true
      } ]
    }, {
      "id" : "blood_pressure",
      "name" : "Blood pressure",
      "localizedName" : "Blood pressure",
      "rmType" : "OBSERVATION",
      "nodeId" : "openEHR-EHR-OBSERVATION.blood_pressure.v2",
      "min" : 0,
      "max" : 1,
      "localizedNames" : {
        "en" : "Blood pressure"
      },
      "localizedDescriptions" : {
        "en" : "The local measurement of arterial blood pressure which is a surrogate for arterial pressure in the systemic circulation."
      },
      "annotations" : {
        "comment" : "Most commonly, use of the term 'blood pressure' refers to measurement of brachial artery pressure in the upper arm."
      },
      "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]",
      "children" : [ {
        "id" : "systolic",
        "name" : "Systolic",
        "localizedName" : "Systolic",
        "rmType" : "DV_QUANTITY",
        "nodeId" : "at0004",
        "min" : 0,
        "max" : 1,
        "localizedNames" : {
          "en" : "Systolic"
        },
        "localizedDescriptions" : {
          "en" : "Peak systemic arterial blood pressure  - measured in systolic or contraction phase of the heart cycle."
        },
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value",
        "inputs" : [ {
          "suffix" : "magnitude",
          "type" : "DECIMAL",
          "validation" : {
            "range" : {
              "minOp" : ">=",
              "min" : 0.0,
              "maxOp" : "<",
              "max" : 1000.0
            },
            "precision" : {
              "minOp" : ">=",
              "min" : 0,
              "maxOp" : "<=",
              "max" : 0
            }
          }
        }, {
          "suffix" : "unit",
          "type" : "CODED_TEXT",
          "list" : [ {
            "value" : "mm[Hg]",
            "label" : "mm[Hg]",
            "localizedLabels" : {
              "en" : "mmHg"
            },
            "validation" : {
              "range" : {
                "minOp" : ">=",
                "min" : 0.0,
                "maxOp" : "<",
                "max" : 1000.0
              },
              "precision" : {
                "minOp" : ">=",
                "min" : 0,
                "maxOp" : "<=",
                "max" : 0
              }
            }
          } ]
        } ],
        "termBindings" : {
          "SNOMED-CT" : {
            "value" : "[SNOMED-CT(2003)::271649006]",
            "terminologyId" : "SNOMED-CT"
          }
        }
      }, {
        "id" : "diastolic",
        "name" : "Diastolic",
        "localizedName" : "Diastolic",
        "rmType" : "DV_QUANTITY",
        "nodeId" : "at0005",
        "min" : 0,
        "max" : 1,
        "localizedNames" : {
          "en" : "Diastolic"
        },
        "localizedDescriptions" : {
          "en" : "Minimum systemic arterial blood pressure - measured in the diastolic or relaxation phase of the heart cycle."
        },
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value",
        "inputs" : [ {
          "suffix" : "magnitude",
          "type" : "DECIMAL",
          "validation" : {
            "range" : {
              "minOp" : ">=",
              "min" : 0.0,
              "maxOp" : "<",
              "max" : 1000.0
            },
            "precision" : {
              "minOp" : ">=",
              "min" : 0,
              "maxOp" : "<=",
              "max" : 0
            }
          }
        }, {
          "suffix" : "unit",
          "type" : "CODED_TEXT",
          "list" : [ {
            "value" : "mm[Hg]",
            "label" : "mm[Hg]",
            "localizedLabels" : {
              "en" : "mmHg"
            },
            "validation" : {
              "range" : {
                "minOp" : ">=",
                "min" : 0.0,
                "maxOp" : "<",
                "max" : 1000.0
              },
              "precision" : {
                "minOp" : ">=",
                "min" : 0,
                "maxOp" : "<=",
                "max" : 0
              }
            }
          } ]
        } ],
        "termBindings" : {
          "SNOMED-CT" : {
            "value" : "[SNOMED-CT(2003)::271650006]",
            "terminologyId" : "SNOMED-CT"
          }
        }
      }, {
        "id" : "time",
        "name" : "Time",
        "rmType" : "DV_DATE_TIME",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/time",
        "inputs" : [ {
          "type" : "DATETIME"
        } ],
        "inContext" : true
      }, {
        "id" : "language",
        "name" : "Language",
        "rmType" : "CODE_PHRASE",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/language",
        "inContext" : true
      }, {
        "id" : "encoding",
        "name" : "Encoding",
        "rmType" : "CODE_PHRASE",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/encoding",
        "inContext" : true
      }, {
        "id" : "subject",
        "name" : "Subject",
        "rmType" : "PARTY_PROXY",
        "min" : 1,
        "max" : 1,
        "aqlPath" : "/content[openEHR-EHR-OBSERVATION.blood_pressure.v2]/subject",
        "inputs" : [ {
          "suffix" : "id",
          "type" : "TEXT"
        }, {
          "suffix" : "id_scheme",
          "type" : "TEXT"
        }, {
          "suffix" : "id_namespace",
          "type" : "TEXT"
        }, {
          "suffix" : "name",
          "type" : "TEXT"
        } ],
        "inContext" : true
      } ],
      "termBindings" : {
        "SNOMED-CT" : {
          "value" : "[SNOMED-CT(2003)::364090009]",
          "terminologyId" : "SNOMED-CT"
        }
      }
    }, {
      "id" : "category",
      "rmType" : "DV_CODED_TEXT",
      "nodeId" : "",
      "min" : 1,
      "max" : 1,
      "aqlPath" : "/category",
      "inputs" : [ {
        "suffix" : "code",
        "type" : "CODED_TEXT",
        "list" : [ {
          "value" : "433",
          "label" : "event",
          "localizedLabels" : {
            "en" : "event"
          }
        } ],
        "terminology" : "openehr"
      } ],
      "inContext" : true
    }, {
      "id" : "language",
      "name" : "Language",
      "rmType" : "CODE_PHRASE",
      "min" : 1,
      "max" : 1,
      "aqlPath" : "/language",
      "inContext" : true
    }, {
      "id" : "territory",
      "name" : "Territory",
      "rmType" : "CODE_PHRASE",
      "min" : 1,
      "max" : 1,
      "aqlPath" : "/territory",
      "inContext" : true
    }, {
      "id" : "composer",
      "name" : "Composer",
      "rmType" : "PARTY_PROXY",
      "min" : 1,
      "max" : 1,
      "aqlPath" : "/composer",
      "inputs" : [ {
        "suffix" : "id",
        "type" : "TEXT"
      }, {
        "suffix" : "id_scheme",
        "type" : "TEXT"
      }, {
        "suffix" : "id_namespace",
        "type" : "TEXT"
      }, {
        "suffix" : "name",
        "type" : "TEXT"
      } ],
      "inContext" : true
    } ]
  }
}
    async function handleSubmit(event) {
        event.preventDefault();
        const composition = form.export();
        console.log('Composition data:', composition);
        const ehrId = '1bdea245-c51f-4522-a802-10b7af1d349a';
        const templateId = 'vital_signs.v1';
        const response = await fetch(`http://localhost:8080/ehrbase/rest/openehr/v1/ehr/${ehrId}/composition?templateId=${templateId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/openehr.wt.flat.schema+json',
                'Accept': 'application/openehr.wt.flat.schema+json',
                'Prefer': 'return=representation'
            },
            body: JSON.stringify(composition)
        });
        const body = await response.json();
        console.log("Posted", body);
    }
</script>
<style>
    .vital-signs-form {
        max-width: 400px;
        margin: 20px auto;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        text-align: center;
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: #34495e;
        font-weight: 500;
    }

    .input-wrapper {
        display: inline-flex;
        align-items: center;
        background: white;
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 4px 8px;
    }

    input {
        border: none;
        outline: none;
        width: 80px;
        padding: 4px;
        font-size: 16px;
    }

    .unit {
        color: #6c757d;
        margin-left: 4px;
        font-size: 14px;
    }

    .bp-inputs {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .separator {
        font-size: 20px;
        color: #6c757d;
    }

    button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        font-size: 16px;
        transition: background 0.2s;
    }

    button:hover {
        background: #0056b3;
    }
</style>
